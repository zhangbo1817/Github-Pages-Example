---
layout:     post
title:      性能优化实践
category: blog
description: mysql数据库性能优化
---

## 背景
性能优化的范畴非常广泛，本文主要针对大型互联网系统来分析如何实现系统性能的提升。

## 性能优化是怎么做的
系统性能优化主要分为以下几步
<ul>
<li> 系统性能分析 </li>
<li> 容量评估和风险识别 </li>
<li> 治理和优化 </li>
</ul>


### 一、系统性能分析
系统性能分析中，主要包括对系统主要调用接口的流量识别和下游依赖识别。系统主要调用接口的流量识别的作用是判断哪些接口属于核心接口。将核心接口梳理出来后，分析核心接口对下游依赖的链路和放大倍数，如对缓存的依赖，对数据库的依赖，对搜索引擎的依赖，同时分析对每一个下游链路依赖的放大倍数。将这些梳理完成后，对系统本身会有一个比较清晰的运行时认知。

### 二、容量评估
容量评估是针对即将到来的特殊场景，如大促活动时需要提前去预估即将到来的流量，这个也非常重要，预估系统流量需要做到精准有效，这里不详细讲流量评估。

### 三、系统治理
系统治理将主要针对有风险的接口进行，如RT比较高的接口，流量比较大的接口。下图总结了如何进行稳定性治理的一些系统方法

![sys_method](/images/optimizesys/11.png)

注意上图中有些系统属于阿里内部系统，但是目前外部都有可替代的产品。

* 下面针对性地讲一个最佳实践

我们在对系统的分析中发现投放位的查询接口存在很高的风险，因为调用量比较大，同时业务流程相当复杂，工作流的分支逻辑节点近百个。这就对数据库造成了很大的查询压力，导致优化数据库性能成了核心路径。从优化数据库链路出发，对于投放位的数据，我们从业务上分析了系统中可以加入缓存的地方，加入了分布式缓存，加入缓存后效果是立竿见影的，DB的日常QPS一下从15K下降到8K左右。但是由于接口评估的流量比较大，日常8K仍然不足以保证大促当天能抗住流量高峰，根据评估，流量高峰对数据库造成的峰值压力会增加15-20K，也就是db的最大压力可能会达到3wQPS，由于数据库并不是分库分表的，3WQPS相对来说还是非常高的，可能会造成数据库瞬间超时挂掉。目标是峰值QPS能降到2W以下。
